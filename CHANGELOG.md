# 更新日志

> 此文档为 `QQBot_go` 项目的更新日志

## [ 0.9.0 ] - 2023-07-12

### 新增

- 新增 ChatGPT 回答问题，程序接入 OpenAI，使程序可以像 ChatGPT 一样回答问题
- 新增对 GitHub workflow 的支持，使项目可以自动打包 Docker 镜像
- 新增 /p 获取随机图片命令
- 新增指定刷屏次数和刷屏内容的刷屏方式
- 新增依赖管理工具
- 添加使用说明

### 更新

- 更新 Golang 版本和部分包
- 更改定时事件
- 更新打卡回复消息

### 优化

- 优化代码结构，添加部分注释

- 优化 websocket 重连逻辑

- 优化 `/help` 及其它命令回复格式

  ```
   ====>  帮助信息  <==== 
  
  ● /help 获取帮助
  ● /info 获取机器人信息
  
   ====>  功能指令  <==== 
  
  ● /dk 进行打卡
  ● /sp 进行刷屏
  ● /p  获取随机风景图
  ```

### 修复

- 修复内存泄漏 bug
- 修复部分逻辑问题

---

## [0.8.5] - 2023-1-2

### 新增

- 对于 `docker` 容器的支持
- 增加 `/date` 命令
- 新增前置消息设置，用于区分生产和测试环境

### 优化

- 优化代码格式、变量名称、注释格式

- 优化 `/help` 命令回复格式

   ```
    =====> 帮助信息 <=====
    ● /help 获取帮助
    ● /info 获取机器人信息
    
    ● /dk 进行打卡
    ● /sp 进行刷屏
   ```

- 优化日志格式

   ```
   2006-01-02 15:04:05
   ```

### 更改

- 更改 `/test` 命令回复

------

## [0.8.4] - 2022-11-5

### 新增

- 增加打卡表情包

### 修复

- 修复跨群刷屏bug

## [0.8.3] - 2022-10-28

### 新增

- 新增发送刷屏提示消息1分钟后自动撤回，使群消息更加简洁
- 新增配置文件，使机器人更加通用

### 优化

- 优化程序初始化逻辑

## [0.8.2] - 2022-10-27

### 变更

- 更改刷屏超时时间为5min

### 优化

- 优化了项目代码，使大部分代码符合规范

### 修复

- 修复一个小bug

## [0.8.1] - 2022-10-25

### 新增

- 增加刷屏超时取消，优化体验

### 优化

- 优化了刷屏功能代码的逻辑

### 修复

- 修复严重bug，Bot与QQ官方的机器人互相@时会出现@循环，严重影响使用体验
- 修复严重bug，处理命令时，对 `message` 切片会出现长度不足导致程序退出

## [0.8.0] - 2022-10-25

### 新增

- 新增 `/sp` 刷屏命令，会将用户发送 `/sp` 的下一条消息作为刷屏消息（可以更加方便刷屏了！）
- 增加log库创建logs文件夹的判断，不会再打印错误

### 变更

- 重写了 `internal/httpapi` 下请求api的方法，使用 `application/json` 作为请求体的格式

### 修复

- 修复了部分种类消息会无法发送的bug

## [0.7.6] - 2022-10-23

### 新增

- 新增Group中对表情包命令的处理，通过计算文件的MD5值来判断

### 变更

- 更改对于消息切片长度不足的处理

```go
//因为切片会出现长度不足，所以会抛出异常
defer func() { recover() }()
if message[0:1] == "/" || message[0:3] == "／" {
    httpapi.Send_group_msg(groupID, "命令输入错误或没有此命令\n请输入 /help 查看帮助")
} else if strings.Index(message, "[CQ:at,qq=2700154874]") != -1 {
    httpapi.Send_group_msg(groupID, fmt.Sprintf("[CQ:at,qq=%s] 叫你爸爸干嘛？", userID))
}
```

### 优化

- 优化 `service/handle_order/Group.go` 的代码，添加一堆注释
- 优化 `0.7.5` 版本对于@机器人 消息的处理，使机器人不会”以下犯上“

## [0.7.5] - 2022-10-19

### 新增

- 增加@机器人时回复：叫你爸爸干嘛？

### 优化

- 优化整体项目结构，使项目更好开发（应该）

## [0.7.4] - 2022-10-19

### 修复

- 修复严重bug，处理命令时，对 `message` 切片会出现长度不足导致程序退出

```go
//文件: service/handle_order/Group.go:46
default:
		if message[0:1] == "/" || message[0:3] == "／" {
			httpapi.Send_group_msg(groupID, "命令输入错误或没有此命令\n请输入 /help 查看帮助")
		}
	}
```

## [0.7.3] - 2022-10-18

### 变更

- 更改 `/help` 命令回复消息

```go
var help_info = "----------帮助信息----------" +
	"\n\n/help 获取帮助" +
	"\n/info 获取机器人信息" +
	"\n\n/dk 进行打卡"
```

### 移除

- 移除了对命令触发的限制，可以使用 `／` 作为命令触发符号

## [0.7.2] - 2022-10-17

### 新增

- 增加打卡方式

### 变更

- 更改命令处理逻辑

## [0.7.1] - 2022-10-14

### 变更

- 变更`/info`命令回复消息

```go
var info = "本机器人由YGXB_net开发" +
	"\nQQ:3040809965" +
	"\n\n当前版本: " + base.Version +
	"\n更新日志: https://gitee.com/YGXB-net/QQBot_go/blob/master/CHANGELOG.md"
```

### 优化

- 优化了项目结构

## [0.7.0] - 2022-10-13

### 新增

- 添加`github.com/sirupsen/logrus`，项目全面使用log框架进行输出管理
- 日志输出文件保存到`logs`文件夹 (文件格式: 2022-10-12.log)
- 错误日志增加调用文件详细信息后单独保存 (文件格式: error-2022-10-12.log)
- 接收消息错误后重连
- 新增`CHANGLOG.md`文件，用于记录更新日志

### 变更

- 更改`QQBot\api`对http请求结果的处理

- 变更`.gitignore`文件

- 变更`/info`命令回复消息

  ```go
  var info = "本机器人由YGXB_net开发" +
  	"\nQQ:3040809965" +
  	"\n\n当前版本: " + data.Version +
  	"\n更新日志: https://gitee.com/YGXB-net/QQBot_go/blob/develop/CHANGELOG.md"
  ```

### 优化

- 优化websocket连接逻辑

- 优化打印接收到消息的格式